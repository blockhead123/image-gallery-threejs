!function(a){a.fn.ig3js=function(b){function c(a){var b=0;a||(a=window.event),a.wheelDelta?b=a.wheelDelta/120:a.detail&&(b=-a.detail),b&&F===!1&&d(b/Math.abs(b))}function d(a){x++,x>=u&&(x=0);for(var b=0,c=0;u>c;c++)b=q[c],b+=a,0>b?b=u-1:b>=u&&(b-=u),q[c]=b;e(!1)}function e(a){var b,c,d,e=!0,g=1,h=1,i=0,j=0,k=y;a===!0&&(k=0);var l=0;a===!1&&(l=0);for(var m=0;u>m;m++)j=q[m],d=!1,0===j?(b=j*A,e=!0,g=1,d=!0,i=0,t[m].side=0,t[m].dif=0):E>=j?(b=j*A,g=C>=j?1:0,e=j>C+3?!1:!0,i=-j*D,t[m].side=1,t[m].dif=j):(j=-(j-u),b=-j*A,g=C>=j?1:0,e=j>C+3?!1:!0,i=j*D,t[m].side=2,t[m].dif=j),0!==k&&(h=e===!0?1:0),c=j*B,s[m].visible=e,0==i&&(I=m),TweenMax.to(s[m].position,k*h,{x:b,z:-c,delay:l*j*y/3,onComplete:K,onCompleteParams:[m,i,s]}),TweenMax.to(s[m].rotation,k*h,{y:i*Math.PI/180,delay:l*j*y/3}),TweenMax.to(s[m].material,k*h,{opacity:g,delay:l*j*y/3}),F=!0,setTimeout(f,75*k)}function f(){F=!1}function g(a){x=a;var b,c;if(0===t[a].side)console.log("click action");else for(c=1===t[a].side?-1:1,b=0;b<t[a].dif;b++)setTimeout(d,100*b,c)}function h(){m.aspect=window.innerWidth/window.innerHeight,m.updateProjectionMatrix(),n.setSize(window.innerWidth,window.innerHeight),j()}function i(){requestAnimationFrame(i),1==v.stats&&p.update(),j()}function j(){n.render(l,m)}function k(a){a.preventDefault();var b=new THREE.Vector3(a.clientX/window.innerWidth*2-1,2*-(a.clientY/window.innerHeight)+1,.5);o.unprojectVector(b,m);var c=new THREE.Raycaster(m.position,b.sub(m.position).normalize()),d=c.intersectObjects(r.children);if(d.length>0){for(var e=0;u>e&&s[e]!==d[0].object;e++);t[e].dif<=C&&g(e)}}var l,m,n,o,p,q,r,s,t,u,v=a.extend({dx:300,dz:300,deltaRotation:45,planeSize:500,manifest:[],imagePath:"",alphaBackground:!0,antialias:!0,progress:{light:"#ff0000",ambientLight:"#ffffff",position:[0,100,0]},onImageLoadProgress:null,onImageLoadComplete:null,onImageLoad:null,onNavigateComplete:null,stats:!1},b),w=this,x=0,y=.8,z=v.planeSize,A=v.dx,B=v.dz,C=2,D=v.deltaRotation,E=0,F=!1,G=v.manifest,H=v.imagePath,I=0,J=1;w.init=function(){function a(a){TweenMax.to(F.scale,.5,{x:a.progress})}function b(){TweenMax.to(D.material,.5,{opacity:0,delay:.5}),TweenMax.to(F.material,.5,{opacity:0,delay:.5,onComplete:d}),setTimeout(g,1e3)}function d(){l.remove(C)}function f(){}function g(){u=G.length,s=[],t=[],E=Math.floor((u-1)/2),q=[];var a,b=0,c=0;for(a=x;x+u>a;a++)b=a,a>=u&&(b-=u),q[b]=c,c++;for(a=0;u>a;a++){t[a]={side:1,dif:0,rotation:0};var d=new THREE.Texture(I.getResult(G[a].id));d.needsUpdate=!0;var f=new THREE.MeshBasicMaterial({map:d,depthWrite:!0,depthTest:!0,transparent:!0}),g=new THREE.Mesh(new THREE.PlaneGeometry(z,z),f);g.overdraw=!0,g.position.x=a*A,r.add(g),s[a]=g}window.addEventListener&&window.addEventListener("DOMMouseScroll",j,!1),window.onmousewheel=document.onmousewheel=j,document.addEventListener("mousedown",k,!1),e(!0)}function j(a){c(a),a.preventDefault()}l=new THREE.Scene,m=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,2e4),m.position.set(0,100,1e3),l.add(m),n=Detector.webgl?new THREE.WebGLRenderer({antialias:v.antialias,alpha:v.alphaBackground}):new THREE.CanvasRenderer;var w=document.createElement("div");document.body.appendChild(w),w.appendChild(n.domElement);var y=new THREE.PointLight(v.progress.light);y.position.set(500,500,0),l.add(y);var B=new THREE.AmbientLight(v.progress.ambientLight);l.add(B),r=new THREE.Object3D,r.position.y=z/2,l.add(r);var C=new THREE.Object3D;C.position.set(v.progress.position[0],v.progress.position[1],v.progress.position[2]),l.add(C);var D=new THREE.Mesh(new THREE.PlaneGeometry(500,30,1,1),new THREE.MeshBasicMaterial({color:"#0f0f2e",transparent:!0}));C.add(D);var F=new THREE.Mesh(new THREE.PlaneGeometry(494,24,1,1),new THREE.MeshBasicMaterial({color:"#00e5e5",transparent:!0}));F.position.set(0,0,1),F.scale.x=0,C.add(F);var I=new createjs.LoadQueue(!1,H);I.addEventListener("progress",a),I.addEventListener("complete",b),I.addEventListener("fileload",f),I.loadManifest(G),o=new THREE.Projector,1==v.stats&&(p=new Stats,p.domElement.style.position="absolute",p.domElement.style.left="0px",p.domElement.style.top="0px",p.domElement.style.zIndex=100,w.appendChild(p.domElement)),window.addEventListener("resize",h,!1),h(),i()};var K=function(a,b,c){a==I&&w.triggerEvent("on-navigate-complete",c[I])};w.navigate={next:function(){g(t.length>I+1?I+1:0)},prev:function(){g(I>0?I-1:t.length-1)},goTo:function(a){g(a)}};var L={position:{x:0,y:100,z:1e3},rotation:{x:0,y:0,z:0}},M=function(a){TweenMax.to(L.position,J,{x:a.position.x,y:a.position.y,z:a.position.z,onUpdate:function(){m.position.set(this.target.x,this.target.y,this.target.z)}}),TweenMax.to(L.rotation,J,{x:a.rotation.x*Math.PI/180,y:a.rotation.y*Math.PI/180,z:a.rotation.z*Math.PI/180,onUpdate:function(){console.log(this.target.x),m.rotation.x=this.target.x,m.rotation.y=this.target.y,m.rotation.z=this.target.z}})};w.perspective={"default":function(){var a={position:{x:0,y:100,z:1e3},rotation:{x:0,y:0,z:0}};M(a)},topRight:function(){var a={position:{x:600,y:700,z:800},rotation:{x:-30,y:30,z:15}};M(a)},topLeft:function(){var a={position:{x:-600,y:700,z:800},rotation:{x:-30,y:-30,z:-15}};M(a)}};var N=function(a,b){0!=a&&a(b)};return w.triggerEvent=function(a,b){return"on-image-load-complete"==a?void N(v.onImageLoadComplete,this):"on-image-load-progress"==a?void N(v.onImageLoadProgress,this):"on-image-load"==a?void N(v.onImageLoad,this):"on-navigate-complete"==a?void N(v.onNavigateComplete,b):void 0},w.init(),w}}(jQuery);