!function(a){a.fn.ig3js=function(b){function c(a){w++,w>=t&&(w=0);for(var b=0,c=0;t>c;c++)b=p[c],b+=a,0>b?b=t-1:b>=t&&(b-=t),p[c]=b;d(!1)}function d(a){var b,c,d,f=!0,g=1,h=1,i=0,j=0,k=x;a===!0&&(k=0);var l=0;a===!1&&(l=0);for(var m=0;t>m;m++)j=p[m],d=!1,0===j?(b=j*z,f=!0,g=1,d=!0,i=0,s[m].side=0,s[m].dif=0):D>=j?(b=j*z,g=B>=j?1:0,f=j>B+3?!1:!0,i=-j*C,s[m].side=1,s[m].dif=j):(j=-(j-t),b=-j*z,g=B>=j?1:0,f=j>B+3?!1:!0,i=j*C,s[m].side=2,s[m].dif=j),0!==k&&(h=f===!0?1:0),c=j*A,r[m].visible=f,0==i&&(H=m),TweenMax.to(r[m].position,k*h,{x:b,z:-c,delay:l*j*x/3,onComplete:J,onCompleteParams:[m,i,r]}),TweenMax.to(r[m].rotation,k*h,{y:i*Math.PI/180,delay:l*j*x/3}),TweenMax.to(r[m].material,k*h,{opacity:g,delay:l*j*x/3}),E=!0,setTimeout(e,75*k)}function e(){E=!1}function f(a){w=a;var b,d;if(0===s[a].side)console.log("click action");else for(d=1===s[a].side?-1:1,b=0;b<s[a].dif;b++)setTimeout(c,100*b,d)}function g(){l.aspect=wndw.innerWidth/wndw.innerHeight,l.updateProjectionMatrix(),m.setSize(wndw.innerWidth,wndw.innerHeight),i()}function h(){requestAnimationFrame(h),1==u.stats&&o.update(),i()}function i(){m.render(k,l)}function j(a){a.preventDefault();var b=new THREE.Vector3(a.clientX/wndw.innerWidth*2-1,2*-(a.clientY/wndw.innerHeight)+1,.5);n.unprojectVector(b,l);var c=new THREE.Raycaster(l.position,b.sub(l.position).normalize()),d=c.intersectObjects(q.children);if(d.length>0){for(var e=0;t>e&&r[e]!==d[0].object;e++);s[e].dif<=B&&f(e)}}var k,l,m,n,o,p,q,r,s,t,u=a.extend({dx:300,dz:300,deltaRotation:45,planeSize:500,manifest:[],imagePath:"",alphaBackground:!0,antialias:!0,progress:{light:"#ff0000",ambientLight:"#ffffff",position:[0,100,0]},onImageLoadProgress:null,onImageLoadComplete:null,onImageLoad:null,onNavigateComplete:null,stats:!1,canvasWindow:{defaultWidth:window.innerWidth,defaultHeight:window.innerHeight}},b),v=this,w=0,x=.8,y=u.planeSize,z=u.dx,A=u.dz,B=2,C=u.deltaRotation,D=0,E=!1,F=u.manifest,G=u.imagePath,H=0,I=1;v.init=function(){function a(a){TweenMax.to(C.scale,.5,{x:a.progress})}function b(a){TweenMax.to(B.material,.5,{opacity:0,delay:.5}),TweenMax.to(C.material,.5,{opacity:0,delay:.5,onComplete:c}),setTimeout(f,1e3)}function c(){k.remove(A)}function e(a){}function f(){t=F.length,r=[],s=[],D=Math.floor((t-1)/2),p=[];var a,b=0,c=0;for(a=w;w+t>a;a++)b=a,a>=t&&(b-=t),p[b]=c,c++;for(a=0;t>a;a++){s[a]={side:1,dif:0,rotation:0};var e=new THREE.Texture(E.getResult(F[a].id));e.needsUpdate=!0;var f=new THREE.MeshBasicMaterial({map:e,depthWrite:!0,depthTest:!0,transparent:!0}),g=new THREE.Mesh(new THREE.PlaneGeometry(y,y),f);g.overdraw=!0,g.name=F[a].id,g.position.x=a*z,q.add(g),r[a]=g}document.addEventListener("mousedown",j,!1),d(!0)}k=new THREE.Scene,wndw={innerWidth:u.canvasWindow.defaultWidth,innerHeight:u.canvasWindow.defaultHeight},l=new THREE.PerspectiveCamera(45,wndw.innerWidth/wndw.innerHeight,1,2e4),l.position.set(0,100,1e3),k.add(l),m=Detector.webgl?new THREE.WebGLRenderer({antialias:u.antialias,alpha:u.alphaBackground}):new THREE.CanvasRenderer;var i=this[0];i.appendChild(m.domElement);var v=new THREE.PointLight(u.progress.light);v.position.set(500,500,0),k.add(v);var x=new THREE.AmbientLight(u.progress.ambientLight);k.add(x),q=new THREE.Object3D,q.position.y=y/2,k.add(q);var A=new THREE.Object3D;A.position.set(u.progress.position[0],u.progress.position[1],u.progress.position[2]),k.add(A);var B=new THREE.Mesh(new THREE.PlaneGeometry(500,30,1,1),new THREE.MeshBasicMaterial({color:"#0f0f2e",transparent:!0}));A.add(B);var C=new THREE.Mesh(new THREE.PlaneGeometry(494,24,1,1),new THREE.MeshBasicMaterial({color:"#00e5e5",transparent:!0}));C.position.set(0,0,1),C.scale.x=0,A.add(C);var E=new createjs.LoadQueue(!1,G);E.addEventListener("progress",a),E.addEventListener("complete",b),E.addEventListener("fileload",e),E.loadManifest(F),n=new THREE.Projector,1==u.stats&&(o=new Stats,o.domElement.style.position="absolute",o.domElement.style.left="0px",o.domElement.style.top="0px",o.domElement.style.zIndex=100,i.appendChild(o.domElement)),window.addEventListener("resize",g,!1),g(),h()};var J=function(a,b,c){a==H&&v.triggerEvent("on-navigate-complete",c[H])};v.navigate={next:function(){f(s.length>H+1?H+1:0)},prev:function(){f(H>0?H-1:s.length-1)},goTo:function(a){f(a)}};var K={position:{x:0,y:100,z:1e3},rotation:{x:0,y:0,z:0}},L=function(a){TweenMax.to(K.position,I,{x:a.position.x,y:a.position.y,z:a.position.z,onUpdate:function(){l.position.set(this.target.x,this.target.y,this.target.z)}}),TweenMax.to(K.rotation,I,{x:a.rotation.x*Math.PI/180,y:a.rotation.y*Math.PI/180,z:a.rotation.z*Math.PI/180,onUpdate:function(){console.log(this.target.x),l.rotation.x=this.target.x,l.rotation.y=this.target.y,l.rotation.z=this.target.z}})};v.perspective={"default":function(){var a={position:{x:0,y:100,z:1e3},rotation:{x:0,y:0,z:0}};L(a)},topRight:function(){var a={position:{x:600,y:700,z:800},rotation:{x:-30,y:30,z:15}};L(a)},topLeft:function(){var a={position:{x:-600,y:700,z:800},rotation:{x:-30,y:-30,z:-15}};L(a)}};var M=function(a,b){0!=a&&a(b)};return v.triggerEvent=function(a,b){return"on-image-load-complete"==a?void M(u.onImageLoadComplete,this):"on-image-load-progress"==a?void M(u.onImageLoadProgress,this):"on-image-load"==a?void M(u.onImageLoad,this):"on-navigate-complete"==a?void M(u.onNavigateComplete,b):void 0},v.init(),v}}(jQuery);