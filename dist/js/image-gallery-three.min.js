function init(){function a(a){TweenMax.to(n.scale,.5,{x:a.progress})}function b(){TweenMax.to(m.material,.5,{opacity:0,delay:.5}),TweenMax.to(n.material,.5,{opacity:0,delay:.5,onComplete:c}),setTimeout(e,1e3)}function c(){scene.remove(l)}function d(){}function e(){len=o.length,planes=[],slides=[],half=Math.floor((len-1)/2),positions=[];var a,b=0,c=0;for(a=select;select+len>a;a++)b=a,a>=len&&(b-=len),positions[b]=c,c++;for(a=0;len>a;a++){slides[a]={side:1,dif:0,rotation:0};var d=new THREE.Texture(p.getResult(o[a].id));d.needsUpdate=!0;var e=new THREE.MeshBasicMaterial({map:d,depthWrite:!0,depthTest:!0,transparent:!0}),g=new THREE.Mesh(new THREE.PlaneGeometry(planeSize,planeSize),e);g.overdraw=!0,g.position.x=a*dx,group.add(g),planes[a]=g}window.addEventListener&&window.addEventListener("DOMMouseScroll",f,!1),window.onmousewheel=document.onmousewheel=f,document.addEventListener("mousedown",onDocumentMouseDown,!1),updatePlanes(!0)}function f(a){mouseWheel(a),a.preventDefault()}scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,2e4),camera.position.set(0,100,1e3),scene.add(camera),renderer=Detector.webgl?new THREE.WebGLRenderer({antialias:!0}):new THREE.CanvasRenderer;var g=document.createElement("div");document.body.appendChild(g),g.appendChild(renderer.domElement);var h=new THREE.PointLight(16711680);h.position.set(500,500,0),scene.add(h);var i=new THREE.AmbientLight(16777215);scene.add(i);var j=document.createElement("div");j.style.position="absolute",j.style.top="5px",j.style.width="100%",j.style.textAlign="center",j.innerHTML='<a href="https://github.com/blockhead123" target="_blank">blockhead123</a>',g.appendChild(j);var k=document.createElement("divtoggle");k.style.position="absolute",k.style.top="25px",k.style.width="100%",k.style.textAlign="center",console.log("window.innerWidth: ",window.innerWidth),k.innerHTML=465===window.innerWidth?'<a href="http://jsdo.it/blockhead123/wPKa/fullscreen" target="_blank">TOGGLE FULLSCREEN</a>':'<a href="http://jsdo.it/blockhead123/wPKa/fullscreen">TOGGLE FULLSCREEN</a>',g.appendChild(k),group=new THREE.Object3D,group.position.y=planeSize/2,scene.add(group);var l=new THREE.Object3D;l.position.set(0,100,0),scene.add(l);var m=new THREE.Mesh(new THREE.PlaneGeometry(500,30,1,1),new THREE.MeshBasicMaterial({color:986926,transparent:!0}));l.add(m);var n=new THREE.Mesh(new THREE.PlaneGeometry(494,24,1,1),new THREE.MeshBasicMaterial({color:58853,transparent:!0}));n.position.set(0,0,1),n.scale.x=0,l.add(n);var o=[{src:"image1.jpg",id:"image1"},{src:"image2.jpg",id:"image2"},{src:"image3.jpg",id:"image3"},{src:"image4.jpg",id:"image4"},{src:"image5.jpg",id:"image5"},{src:"image6.jpg",id:"image6"},{src:"image7.jpg",id:"image7"}],p=new createjs.LoadQueue(!1,"http://localhost/image-gallery-threejs/src/images/");p.addEventListener("progress",a),p.addEventListener("complete",b),p.addEventListener("fileload",d),p.loadManifest(o),projector=new THREE.Projector,stats=new Stats,stats.domElement.style.position="absolute",stats.domElement.style.left="0px",stats.domElement.style.top="0px",stats.domElement.style.zIndex=100,g.appendChild(stats.domElement),window.addEventListener("resize",resizeHandler,!1),resizeHandler(),animate()}function mouseWheel(a){var b=0;a||(a=window.event),a.wheelDelta?b=a.wheelDelta/120:a.detail&&(b=-a.detail),b&&tweening===!1&&gotoDir(b/Math.abs(b))}function gotoDir(a){select++,select>=len&&(select=0);for(var b=0,c=0;len>c;c++)b=positions[c],b+=a,0>b?b=len-1:b>=len&&(b-=len),positions[c]=b;updatePlanes(!1)}function updatePlanes(a){var b,c,d,e=!0,f=1,g=1,h=0,i=0,j=tweenTime;a===!0&&(j=0);var k=0;a===!1&&(k=0);for(var l=0;len>l;l++)i=positions[l],d=!1,0===i?(b=i*dx,e=!0,f=1,d=!0,h=0,slides[l].side=0,slides[l].dif=0):half>=i?(b=i*dx,f=show>=i?1:0,e=i>show+3?!1:!0,h=-i*deltaRotation,slides[l].side=1,slides[l].dif=i):(i=-(i-len),b=-i*dx,f=show>=i?1:0,e=i>show+3?!1:!0,h=i*deltaRotation,slides[l].side=2,slides[l].dif=i),0!==j&&(g=e===!0?1:0),c=i*dz,planes[l].visible=e,TweenMax.to(planes[l].position,j*g,{x:b,z:-c,delay:k*i*tweenTime/3}),TweenMax.to(planes[l].rotation,j*g,{y:h*Math.PI/180,delay:k*i*tweenTime/3}),TweenMax.to(planes[l].material,j*g,{opacity:f,delay:k*i*tweenTime/3}),tweening=!0,setTimeout(resetTween,75*j)}function resetTween(){tweening=!1}function gotoImage(a){select=a;var b,c;if(0===slides[a].side)console.log("click action");else for(c=1===slides[a].side?-1:1,b=0;b<slides[a].dif;b++)setTimeout(gotoDir,100*b,c)}function resizeHandler(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight),render()}function animate(){requestAnimationFrame(animate),stats.update(),render()}function render(){renderer.render(scene,camera)}function onDocumentMouseDown(a){a.preventDefault();var b=new THREE.Vector3(a.clientX/window.innerWidth*2-1,2*-(a.clientY/window.innerHeight)+1,.5);projector.unprojectVector(b,camera);var c=new THREE.Raycaster(camera.position,b.sub(camera.position).normalize()),d=c.intersectObjects(group.children);if(d.length>0){for(var e=0;len>e&&planes[e]!==d[0].object;e++);slides[e].dif<=show&&gotoImage(e)}}var scene,camera,renderer,projector,stats,positions,group,planes,slides,len,select=0,tweenTime=.8,planeSize=500,dx=300,dz=300,show=2,deltaRotation=45,half=0,tweening=!1;window.addEventListener("load",init,!1);